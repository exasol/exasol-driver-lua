<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1060px" preserveAspectRatio="none" style="width:1076px;height:1060px;background:#FFFFFF;" version="1.1" viewBox="0 0 1076 1060" width="1076px" zoomAndPan="magnify"><defs/><g><rect height="46.9766" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="324" x="377.5" y="10"/><text fill="#000000" font-family="Calibri" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="310" x="384.5" y="30.5352">Detailed Websocket Request and Response</text><text fill="#000000" font-family="Calibri" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="269" x="405" y="47.0234">(Example request: execute statement)</text><rect fill="#DDDDDD" height="983.6953" style="stroke:#181818;stroke-width:0.5;" width="815" x="109" y="63.9766"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="446" y="78.5449">Exasol Driver for Lua</text><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="149.2637"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="170.5" y="149.2637"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="325" y="149.2637"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="513" y="149.2637"/><rect fill="#FFFFFF" height="798.4766" style="stroke:#181818;stroke-width:1.0;" width="10" x="667.5" y="246.1953"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="990" y="149.2637"/><rect height="168.2422" style="stroke:#000000;stroke-width:1.5;fill:none;" width="507" x="423" y="156.2637"/><rect height="214.8184" style="stroke:#000000;stroke-width:1.5;fill:none;" width="631.5" x="438.5" y="612.9902"/><rect height="70.5762" style="stroke:#000000;stroke-width:1.5;fill:none;" width="481.5" x="448.5" y="641.3008"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="139.2637" y2="1053.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="175" x2="175" y1="139.2637" y2="1053.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="330" x2="330" y1="139.2637" y2="1053.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="517.5" x2="517.5" y1="139.2637" y2="1053.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="672" x2="672" y1="244.3848" y2="1053.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="842" x2="842" y1="139.2637" y2="1053.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="995" x2="995" y1="139.2637" y2="1053.6719"/><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="5" y="87.2871"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="71" x="18.5" y="109.8223">«external»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="80" x="14" y="126.3105">Client Code</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="113" y="102.2637"/><ellipse cx="131" cy="120.2637" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M133.4731,126.4067 Q132.8921,126.7056 132.2529,126.855 Q131.6138,127.0044 130.9082,127.0044 Q128.4014,127.0044 127.0815,125.3525 Q125.7617,123.7007 125.7617,120.5796 Q125.7617,117.4502 127.0815,115.7983 Q128.4014,114.1465 130.9082,114.1465 Q131.6138,114.1465 132.2612,114.2959 Q132.9087,114.4453 133.4731,114.7441 L133.4731,117.4668 Q132.8423,116.8857 132.2488,116.616 Q131.6553,116.3462 131.0244,116.3462 Q129.6797,116.3462 128.9949,117.4128 Q128.3101,118.4795 128.3101,120.5796 Q128.3101,122.6714 128.9949,123.738 Q129.6797,124.8047 131.0244,124.8047 Q131.6553,124.8047 132.2488,124.5349 Q132.8423,124.2651 133.4731,123.6841 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="79" x="150" y="124.7988">Connection</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="248" y="102.2637"/><ellipse cx="266" cy="120.2637" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M268.4731,126.4067 Q267.8921,126.7056 267.2529,126.855 Q266.6138,127.0044 265.9082,127.0044 Q263.4014,127.0044 262.0815,125.3525 Q260.7617,123.7007 260.7617,120.5796 Q260.7617,117.4502 262.0815,115.7983 Q263.4014,114.1465 265.9082,114.1465 Q266.6138,114.1465 267.2612,114.2959 Q267.9087,114.4453 268.4731,114.7441 L268.4731,117.4668 Q267.8423,116.8857 267.2488,116.616 Q266.6553,116.3462 266.0244,116.3462 Q264.6797,116.3462 263.9949,117.4128 Q263.3101,118.4795 263.3101,120.5796 Q263.3101,122.6714 263.9949,123.738 Q264.6797,124.8047 266.0244,124.8047 Q266.6553,124.8047 267.2488,124.5349 Q267.8423,124.2651 268.4731,123.6841 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="118" x="285" y="124.7988">ExasolWebsocket</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="458.5" y="102.2637"/><ellipse cx="476.5" cy="120.2637" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M478.9731,126.4067 Q478.3921,126.7056 477.7529,126.855 Q477.1138,127.0044 476.4082,127.0044 Q473.9014,127.0044 472.5815,125.3525 Q471.2617,123.7007 471.2617,120.5796 Q471.2617,117.4502 472.5815,115.7983 Q473.9014,114.1465 476.4082,114.1465 Q477.1138,114.1465 477.7612,114.2959 Q478.4087,114.4453 478.9731,114.7441 L478.9731,117.4668 Q478.3423,116.8857 477.7488,116.616 Q477.1553,116.3462 476.5244,116.3462 Q475.1797,116.3462 474.4949,117.4128 Q473.8101,118.4795 473.8101,120.5796 Q473.8101,122.6714 474.4949,123.738 Q475.1797,124.8047 476.5244,124.8047 Q477.1553,124.8047 477.7488,124.5349 Q478.3423,124.2651 478.9731,123.6841 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="73" x="495.5" y="124.7988">Websocket</text><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="764" y="87.2871"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="138" x="773" y="109.8223">«Third party library»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="85" x="799.5" y="126.3105">LuWS Socket</text><rect fill="#E2E2F0" height="34.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="930" y="103.7754"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="112" x="939" y="126.3105">Exasol Database</text><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="149.2637"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="170.5" y="149.2637"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="325" y="149.2637"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="513" y="149.2637"/><rect fill="#FFFFFF" height="798.4766" style="stroke:#181818;stroke-width:1.0;" width="10" x="667.5" y="246.1953"/><rect fill="#FFFFFF" height="895.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="990" y="149.2637"/><path d="M423,156.2637 L590,156.2637 L590,167.5742 L580,177.5742 L423,177.5742 L423,156.2637 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="168.2422" style="stroke:#000000;stroke-width:1.5;" width="507" x="423" y="156.2637"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="440" y="171.832">Initial Connection</text><polygon fill="#181818" points="501,198.8848,511,202.8848,501,206.8848" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="420" x2="507" y1="202.8848" y2="202.8848"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="75" x="429" y="196.1426">connect(url)</text><polygon fill="#181818" points="579,232.1953,589,236.1953,579,240.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="523" x2="585" y1="236.1953" y2="236.1953"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="40" x="532" y="229.4531">Create</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="591" y="210.8848"/><ellipse cx="609" cy="228.8848" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M611.4731,235.0278 Q610.8921,235.3267 610.2529,235.4761 Q609.6138,235.6255 608.9082,235.6255 Q606.4014,235.6255 605.0815,233.9736 Q603.7617,232.3218 603.7617,229.2007 Q603.7617,226.0713 605.0815,224.4194 Q606.4014,222.7676 608.9082,222.7676 Q609.6138,222.7676 610.2612,222.917 Q610.9087,223.0664 611.4731,223.3652 L611.4731,226.0879 Q610.8423,225.5068 610.2488,225.2371 Q609.6553,224.9673 609.0244,224.9673 Q607.6797,224.9673 606.9949,226.0339 Q606.3101,227.1006 606.3101,229.2007 Q606.3101,231.2925 606.9949,232.3591 Q607.6797,233.4258 609.0244,233.4258 Q609.6553,233.4258 610.2488,233.156 Q610.8423,232.8862 611.4731,232.3052 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="117" x="628" y="233.4199">Message Handler</text><polygon fill="#181818" points="830,279.1953,840,283.1953,830,287.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="523" x2="836" y1="283.1953" y2="283.1953"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="190" x="532" y="276.4531">wsopen(url, message_handler)</text><polygon fill="#181818" points="534,312.5059,524,316.5059,534,320.5059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="528" x2="841" y1="316.5059" y2="316.5059"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="42" x="542" y="309.7637">Socket</text><polygon fill="#181818" points="158.5,352.8164,168.5,356.8164,158.5,360.8164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="59" x2="164.5" y1="356.8164" y2="356.8164"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="57" x="68" y="350.0742">execute()</text><polygon fill="#181818" points="313,386.127,323,390.127,313,394.127" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="180.5" x2="319" y1="390.127" y2="390.127"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="94" x="189.5" y="383.3848">send_execute()</text><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="377" y1="423.4375" y2="423.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="377" y1="423.4375" y2="436.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="377" y1="436.4375" y2="436.4375"/><polygon fill="#181818" points="346,432.4375,336,436.4375,346,440.4375" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="133" x="344" y="416.6953">Encode JSON payload</text><polygon fill="#181818" points="501,465.748,511,469.748,501,473.748" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="507" y1="469.748" y2="469.748"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="150" x="344" y="463.0059">send_raw(json_payload)</text><polygon fill="#181818" points="830,499.0586,840,503.0586,830,507.0586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="523" x2="836" y1="503.0586" y2="503.0586"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="154" x="532" y="496.3164">wssend(socket, payload)</text><line style="stroke:#181818;stroke-width:1.0;" x1="842" x2="884" y1="551.6797" y2="551.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="884" x2="884" y1="551.6797" y2="564.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="884" y1="564.6797" y2="564.6797"/><polygon fill="#181818" points="853,560.6797,843,564.6797,853,568.6797" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="45" x="851" y="529.627">Encode</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="108" x="851" y="544.9375">Websocket frame</text><polygon fill="#181818" points="978,593.9902,988,597.9902,978,601.9902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="842" x2="984" y1="597.9902" y2="597.9902"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="84" x="851" y="591.248">socket:send()</text><path d="M438.5,612.9902 L605.5,612.9902 L605.5,624.3008 L595.5,634.3008 L438.5,634.3008 L438.5,612.9902 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="214.8184" style="stroke:#000000;stroke-width:1.5;" width="631.5" x="438.5" y="612.9902"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="455.5" y="628.5586">Wait for response</text><path d="M448.5,641.3008 L526.5,641.3008 L526.5,652.6113 L516.5,662.6113 L448.5,662.6113 L448.5,641.3008 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="70.5762" style="stroke:#000000;stroke-width:1.5;" width="481.5" x="448.5" y="641.3008"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="465.5" y="656.8691">loop</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112" x="543.5" y="655.9355">[until data received]</text><polygon fill="#181818" points="830,685.877,840,689.877,830,693.877" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="523" x2="836" y1="689.877" y2="689.877"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="111" x="532" y="683.1348">wsreceive(socket)</text><polygon fill="#181818" points="534,699.877,524,703.877,534,707.877" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="528" x2="841" y1="703.877" y2="703.877"/><polygon fill="#181818" points="853,720.877,843,724.877,853,728.877" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="847" x2="989" y1="724.877" y2="724.877"/><line style="stroke:#181818;stroke-width:1.0;" x1="842" x2="884" y1="773.498" y2="773.498"/><line style="stroke:#181818;stroke-width:1.0;" x1="884" x2="884" y1="773.498" y2="786.498"/><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="884" y1="786.498" y2="786.498"/><polygon fill="#181818" points="853,782.498,843,786.498,853,790.498" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="47" x="851" y="751.4453">Decode</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="108" x="851" y="766.7559">Websocket frame</text><polygon fill="#181818" points="688.5,815.8086,678.5,819.8086,688.5,823.8086" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="682.5" x2="841" y1="819.8086" y2="819.8086"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="110" x="696.5" y="813.0664">Message received</text><polygon fill="#181818" points="655.5,856.1191,665.5,860.1191,655.5,864.1191" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="523" x2="661.5" y1="860.1191" y2="860.1191"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="62" x="532" y="853.377">get_data()</text><polygon fill="#181818" points="534,870.1191,524,874.1191,534,878.1191" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="528" x2="666.5" y1="874.1191" y2="874.1191"/><polygon fill="#181818" points="346,903.4297,336,907.4297,346,911.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="340" x2="512" y1="907.4297" y2="907.4297"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="113" x="354" y="900.6875">Response payload</text><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="377" y1="956.0508" y2="956.0508"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="377" y1="956.0508" y2="969.0508"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="377" y1="969.0508" y2="969.0508"/><polygon fill="#181818" points="346,965.0508,336,969.0508,346,973.0508" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="135" x="344" y="933.998">Decode JSON payload</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="127" x="344" y="949.3086">Check for exception</text><polygon fill="#181818" points="191.5,998.3613,181.5,1002.3613,191.5,1006.3613" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="185.5" x2="324" y1="1002.3613" y2="1002.3613"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="59" x="199.5" y="995.6191">result set</text><polygon fill="#181818" points="70,1031.6719,60,1035.6719,70,1039.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64" x2="169.5" y1="1035.6719" y2="1035.6719"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="40" x="78" y="1028.9297">cursor</text><!--MD5=[55f70437e96d6744bd1bbfceba384f3d]
@startuml seq_websocket_request_response
!include ../clean.skin

title: Detailed Websocket Request and Response\n(Example request: execute statement)

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant "Connection" as conn << (C,#ADD1B2) >>
    participant "ExasolWebsocket" as exaws << (C,#ADD1B2) >>
    participant "Websocket" as ws << (C,#ADD1B2) >>
    participant "Message Handler" as msghandler << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate conn
activate exaws
activate ws
activate db

group Initial Connection
    ?-> ws : connect(url)
    create msghandler
    ws -> msghandler : Create
    activate msghandler

    ws -> luws : wsopen(url, message_handler)
    luws - -> ws : Socket
end

client -> conn : execute()
conn -> exaws : send_execute()
exaws -> exaws : Encode JSON payload
exaws -> ws : send_raw(json_payload)
ws -> luws : wssend(socket, payload)
luws -> luws : Encode\nWebsocket frame
luws -> db : socket:send()
group Wait for response
    loop until data received
        ws -> luws : wsreceive(socket)
        luws - -> ws
    end
    db -> luws
    luws -> luws : Decode\nWebsocket frame
    luws -> msghandler : Message received
end

ws -> msghandler : get_data()
msghandler - -> ws
ws - -> exaws : Response payload
exaws -> exaws : Decode JSON payload\nCheck for exception
exaws - -> conn : result set
conn - -> client : cursor

@enduml

@startuml seq_websocket_request_response
hide empty methods
hide empty attributes
skinparam style strictuml
skinparam classAttributeIconSize 0
!pragma horizontalLineBetweenDifferentPackageAllowed

skinparam defaultFontName Calibri

skinparam padding 2

title: Detailed Websocket Request and Response\n(Example request: execute statement)

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant "Connection" as conn << (C,#ADD1B2) >>
    participant "ExasolWebsocket" as exaws << (C,#ADD1B2) >>
    participant "Websocket" as ws << (C,#ADD1B2) >>
    participant "Message Handler" as msghandler << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate conn
activate exaws
activate ws
activate db

group Initial Connection
    ?-> ws : connect(url)
    create msghandler
    ws -> msghandler : Create
    activate msghandler

    ws -> luws : wsopen(url, message_handler)
    luws - -> ws : Socket
end

client -> conn : execute()
conn -> exaws : send_execute()
exaws -> exaws : Encode JSON payload
exaws -> ws : send_raw(json_payload)
ws -> luws : wssend(socket, payload)
luws -> luws : Encode\nWebsocket frame
luws -> db : socket:send()
group Wait for response
    loop until data received
        ws -> luws : wsreceive(socket)
        luws - -> ws
    end
    db -> luws
    luws -> luws : Decode\nWebsocket frame
    luws -> msghandler : Message received
end

ws -> msghandler : get_data()
msghandler - -> ws
ws - -> exaws : Response payload
exaws -> exaws : Decode JSON payload\nCheck for exception
exaws - -> conn : result set
conn - -> client : cursor

@enduml

PlantUML version 1.2022.2(Sat Mar 05 17:30:19 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>