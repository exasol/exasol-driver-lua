<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1195px" preserveAspectRatio="none" style="width:1145px;height:1195px;background:#FFFFFF;" version="1.1" viewBox="0 0 1145 1195" width="1145px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="1176.248" style="stroke:#181818;stroke-width:0.5;" width="811" x="109" y="6"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="444" y="20.5684">Exasol Driver for Lua</text><rect fill="#FFFFFF" height="1087.9609" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="91.2871"/><rect fill="#FFFFFF" height="871.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="170.5" y="298.8398"/><rect fill="#FFFFFF" height="804.7871" style="stroke:#181818;stroke-width:1.0;" width="10" x="325" y="332.1504"/><rect fill="#FFFFFF" height="630.2344" style="stroke:#181818;stroke-width:1.0;" width="10" x="508" y="411.7715"/><rect fill="#FFFFFF" height="60.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="860.7637"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="994.6953"/><rect fill="#FFFFFF" height="33.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="225.2188"/><rect fill="#FFFFFF" height="108.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="445.082"/><rect fill="#FFFFFF" height="262.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="692.2109"/><rect fill="#FFFFFF" height="155.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="838" y="765.832"/><rect fill="#FFFFFF" height="1087.9609" style="stroke:#181818;stroke-width:1.0;" width="10" x="986" y="91.2871"/><rect fill="#FFFFFF" height="225.8184" style="stroke:#181818;stroke-width:1.0;" width="10" x="991" y="540.0137"/><rect height="168.2422" style="stroke:#000000;stroke-width:1.5;fill:none;" width="513" x="413" y="98.2871"/><rect height="393.3711" style="stroke:#000000;stroke-width:1.5;fill:none;" width="705.5" x="433.5" y="569.0137"/><rect height="89.8867" style="stroke:#000000;stroke-width:1.5;fill:none;" width="482.5" x="443.5" y="643.6348"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="81.2871" y2="1188.248"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="175" x2="175" y1="81.2871" y2="1188.248"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="330" x2="330" y1="81.2871" y2="1188.248"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="512.5" x2="512.5" y1="81.2871" y2="1188.248"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="668" x2="668" y1="186.4082" y2="1188.248"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="838" x2="838" y1="81.2871" y2="1188.248"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="991" x2="991" y1="81.2871" y2="1188.248"/><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="5" y="29.3105"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="71" x="18.5" y="51.8457">«external»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="80" x="14" y="68.334">Client Code</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="113" y="44.2871"/><ellipse cx="131" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M133.4731,68.4302 Q132.8921,68.729 132.2529,68.8784 Q131.6138,69.0278 130.9082,69.0278 Q128.4014,69.0278 127.0815,67.376 Q125.7617,65.7241 125.7617,62.603 Q125.7617,59.4736 127.0815,57.8218 Q128.4014,56.1699 130.9082,56.1699 Q131.6138,56.1699 132.2612,56.3193 Q132.9087,56.4688 133.4731,56.7676 L133.4731,59.4902 Q132.8423,58.9092 132.2488,58.6394 Q131.6553,58.3696 131.0244,58.3696 Q129.6797,58.3696 128.9949,59.4363 Q128.3101,60.5029 128.3101,62.603 Q128.3101,64.6948 128.9949,65.7615 Q129.6797,66.8281 131.0244,66.8281 Q131.6553,66.8281 132.2488,66.5583 Q132.8423,66.2886 133.4731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="79" x="150" y="66.8223">Connection</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="248" y="44.2871"/><ellipse cx="266" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M268.4731,68.4302 Q267.8921,68.729 267.2529,68.8784 Q266.6138,69.0278 265.9082,69.0278 Q263.4014,69.0278 262.0815,67.376 Q260.7617,65.7241 260.7617,62.603 Q260.7617,59.4736 262.0815,57.8218 Q263.4014,56.1699 265.9082,56.1699 Q266.6138,56.1699 267.2612,56.3193 Q267.9087,56.4688 268.4731,56.7676 L268.4731,59.4902 Q267.8423,58.9092 267.2488,58.6394 Q266.6553,58.3696 266.0244,58.3696 Q264.6797,58.3696 263.9949,59.4363 Q263.3101,60.5029 263.3101,62.603 Q263.3101,64.6948 263.9949,65.7615 Q264.6797,66.8281 266.0244,66.8281 Q266.6553,66.8281 267.2488,66.5583 Q267.8423,66.2886 268.4731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="118" x="285" y="66.8223">ExasolWebsocket</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="453.5" y="44.2871"/><ellipse cx="471.5" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M473.9731,68.4302 Q473.3921,68.729 472.7529,68.8784 Q472.1138,69.0278 471.4082,69.0278 Q468.9014,69.0278 467.5815,67.376 Q466.2617,65.7241 466.2617,62.603 Q466.2617,59.4736 467.5815,57.8218 Q468.9014,56.1699 471.4082,56.1699 Q472.1138,56.1699 472.7612,56.3193 Q473.4087,56.4688 473.9731,56.7676 L473.9731,59.4902 Q473.3423,58.9092 472.7488,58.6394 Q472.1553,58.3696 471.5244,58.3696 Q470.1797,58.3696 469.4949,59.4363 Q468.8101,60.5029 468.8101,62.603 Q468.8101,64.6948 469.4949,65.7615 Q470.1797,66.8281 471.5244,66.8281 Q472.1553,66.8281 472.7488,66.5583 Q473.3423,66.2886 473.9731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="73" x="490.5" y="66.8223">Websocket</text><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="760" y="29.3105"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="138" x="769" y="51.8457">«Third party library»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="85" x="795.5" y="68.334">LuWS Socket</text><rect fill="#E2E2F0" height="34.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="926" y="45.7988"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="112" x="935" y="68.334">Exasol Database</text><rect fill="#FFFFFF" height="1087.9609" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="91.2871"/><rect fill="#FFFFFF" height="871.4082" style="stroke:#181818;stroke-width:1.0;" width="10" x="170.5" y="298.8398"/><rect fill="#FFFFFF" height="804.7871" style="stroke:#181818;stroke-width:1.0;" width="10" x="325" y="332.1504"/><rect fill="#FFFFFF" height="630.2344" style="stroke:#181818;stroke-width:1.0;" width="10" x="508" y="411.7715"/><rect fill="#FFFFFF" height="60.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="860.7637"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="994.6953"/><rect fill="#FFFFFF" height="33.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="225.2188"/><rect fill="#FFFFFF" height="108.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="445.082"/><rect fill="#FFFFFF" height="262.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="692.2109"/><rect fill="#FFFFFF" height="155.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="838" y="765.832"/><rect fill="#FFFFFF" height="1087.9609" style="stroke:#181818;stroke-width:1.0;" width="10" x="986" y="91.2871"/><rect fill="#FFFFFF" height="225.8184" style="stroke:#181818;stroke-width:1.0;" width="10" x="991" y="540.0137"/><path d="M413,98.2871 L580,98.2871 L580,109.5977 L570,119.5977 L413,119.5977 L413,98.2871 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="168.2422" style="stroke:#000000;stroke-width:1.5;" width="513" x="413" y="98.2871"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="430" y="113.8555">Initial Connection</text><polygon fill="#181818" points="501,140.9082,511,144.9082,501,148.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="410" x2="507" y1="144.9082" y2="144.9082"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="75" x="419" y="138.166">connect(url)</text><polygon fill="#181818" points="575,174.2188,585,178.2188,575,182.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="513" x2="581" y1="178.2188" y2="178.2188"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="46" x="522" y="171.4766">create()</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="587" y="152.9082"/><ellipse cx="605" cy="170.9082" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M607.4731,177.0513 Q606.8921,177.3501 606.2529,177.4995 Q605.6138,177.6489 604.9082,177.6489 Q602.4014,177.6489 601.0815,175.9971 Q599.7617,174.3452 599.7617,171.2241 Q599.7617,168.0947 601.0815,166.4429 Q602.4014,164.791 604.9082,164.791 Q605.6138,164.791 606.2612,164.9404 Q606.9087,165.0898 607.4731,165.3887 L607.4731,168.1113 Q606.8423,167.5303 606.2488,167.2605 Q605.6553,166.9907 605.0244,166.9907 Q603.6797,166.9907 602.9949,168.0574 Q602.3101,169.124 602.3101,171.2241 Q602.3101,173.3159 602.9949,174.3826 Q603.6797,175.4492 605.0244,175.4492 Q605.6553,175.4492 606.2488,175.1794 Q606.8423,174.9097 607.4731,174.3286 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="117" x="624" y="175.4434">Message Handler</text><polygon fill="#181818" points="821,221.2188,831,225.2188,821,229.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="513" x2="827" y1="225.2188" y2="225.2188"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="190" x="522" y="218.4766">wsopen(url, message_handler)</text><polygon fill="#181818" points="524,254.5293,514,258.5293,524,262.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="518" x2="837" y1="258.5293" y2="258.5293"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="42" x="532" y="251.7871">Socket</text><polygon fill="#181818" points="158.5,294.8398,168.5,298.8398,158.5,302.8398" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="59" x2="164.5" y1="298.8398" y2="298.8398"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="57" x="68" y="292.0977">execute()</text><polygon fill="#181818" points="313,328.1504,323,332.1504,313,336.1504" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="180.5" x2="319" y1="332.1504" y2="332.1504"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="94" x="189.5" y="325.4082">send_execute()</text><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="377" y1="365.4609" y2="365.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="377" y1="365.4609" y2="378.4609"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="377" y1="378.4609" y2="378.4609"/><polygon fill="#181818" points="346,374.4609,336,378.4609,346,382.4609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="133" x="344" y="358.7188">Encode JSON payload</text><polygon fill="#181818" points="496,407.7715,506,411.7715,496,415.7715" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="502" y1="411.7715" y2="411.7715"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="150" x="344" y="405.0293">send_raw(json_payload)</text><polygon fill="#181818" points="821,441.082,831,445.082,821,449.082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="518" x2="827" y1="445.082" y2="445.082"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="154" x="527" y="438.3398">wssend(socket, payload)</text><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="885" y1="493.7031" y2="493.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="885" x2="885" y1="493.7031" y2="506.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="844" x2="885" y1="506.7031" y2="506.7031"/><polygon fill="#181818" points="854,502.7031,844,506.7031,854,510.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="45" x="852" y="471.6504">Encode</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="108" x="852" y="486.9609">Websocket frame</text><polygon fill="#181818" points="979,536.0137,989,540.0137,979,544.0137" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="985" y1="540.0137" y2="540.0137"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="84" x="852" y="533.2715">socket:send()</text><polygon fill="#181818" points="529,550.0137,519,554.0137,529,558.0137" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="837" y1="554.0137" y2="554.0137"/><path d="M433.5,569.0137 L600.5,569.0137 L600.5,580.3242 L590.5,590.3242 L433.5,590.3242 L433.5,569.0137 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="393.3711" style="stroke:#000000;stroke-width:1.5;" width="705.5" x="433.5" y="569.0137"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="450.5" y="584.582">Wait for response</text><line style="stroke:#181818;stroke-width:1.0;" x1="1001" x2="1043" y1="615.6348" y2="615.6348"/><line style="stroke:#181818;stroke-width:1.0;" x1="1043" x2="1043" y1="615.6348" y2="628.6348"/><line style="stroke:#181818;stroke-width:1.0;" x1="1002" x2="1043" y1="628.6348" y2="628.6348"/><polygon fill="#181818" points="1012,624.6348,1002,628.6348,1012,632.6348" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="115" x="1010" y="608.8926">Process statement</text><path d="M443.5,643.6348 L521.5,643.6348 L521.5,654.9453 L511.5,664.9453 L443.5,664.9453 L443.5,643.6348 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="89.8867" style="stroke:#000000;stroke-width:1.5;" width="482.5" x="443.5" y="643.6348"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="460.5" y="659.2031">loop</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112" x="538.5" y="658.2695">[until data received]</text><polygon fill="#181818" points="821,688.2109,831,692.2109,821,696.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="518" x2="827" y1="692.2109" y2="692.2109"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="111" x="527" y="685.4688">wsreceive(socket)</text><polygon fill="#181818" points="529,721.5215,519,725.5215,529,729.5215" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="832" y1="725.5215" y2="725.5215"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="106" x="537" y="718.7793">no data available</text><polygon fill="#181818" points="859,761.832,849,765.832,859,769.832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="853" x2="985" y1="765.832" y2="765.832"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="60" x="867" y="759.0898">Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="848" x2="890" y1="814.4531" y2="814.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="890" x2="890" y1="814.4531" y2="827.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="849" x2="890" y1="827.4531" y2="827.4531"/><polygon fill="#181818" points="859,823.4531,849,827.4531,859,831.4531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="47" x="857" y="792.4004">Decode</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="108" x="857" y="807.7109">Websocket frame</text><polygon fill="#181818" points="684.5,856.7637,674.5,860.7637,684.5,864.7637" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="678.5" x2="837" y1="860.7637" y2="860.7637"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="110" x="692.5" y="854.0215">Message received</text><line style="stroke:#181818;stroke-width:1.0;" x1="673.5" x2="715.5" y1="894.0742" y2="894.0742"/><line style="stroke:#181818;stroke-width:1.0;" x1="715.5" x2="715.5" y1="894.0742" y2="907.0742"/><line style="stroke:#181818;stroke-width:1.0;" x1="674.5" x2="715.5" y1="907.0742" y2="907.0742"/><polygon fill="#181818" points="684.5,903.0742,674.5,907.0742,684.5,911.0742" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="91" x="682.5" y="887.332">Store message</text><polygon fill="#181818" points="821,917.0742,831,921.0742,821,925.0742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="668.5" x2="827" y1="921.0742" y2="921.0742"/><polygon fill="#181818" points="529,950.3848,519,954.3848,529,958.3848" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="837" y1="954.3848" y2="954.3848"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="86" x="537" y="947.6426">data available</text><polygon fill="#181818" points="651.5,990.6953,661.5,994.6953,651.5,998.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="518" x2="657.5" y1="994.6953" y2="994.6953"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="62" x="527" y="987.9531">get_data()</text><polygon fill="#181818" points="529,1004.6953,519,1008.6953,529,1012.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="667.5" y1="1008.6953" y2="1008.6953"/><polygon fill="#181818" points="346,1038.0059,336,1042.0059,346,1046.0059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="340" x2="512" y1="1042.0059" y2="1042.0059"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="113" x="354" y="1035.2637">Response payload</text><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="377" y1="1090.627" y2="1090.627"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="377" y1="1090.627" y2="1103.627"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="377" y1="1103.627" y2="1103.627"/><polygon fill="#181818" points="346,1099.627,336,1103.627,346,1107.627" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="139" x="344" y="1068.5742">Decode JSON payload,</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="125" x="344" y="1083.8848">check for exception</text><polygon fill="#181818" points="191.5,1132.9375,181.5,1136.9375,191.5,1140.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="185.5" x2="329" y1="1136.9375" y2="1136.9375"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="59" x="199.5" y="1130.1953">result set</text><polygon fill="#181818" points="70,1166.248,60,1170.248,70,1174.248" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64" x2="174.5" y1="1170.248" y2="1170.248"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="40" x="78" y="1163.5059">cursor</text><!--MD5=[00a03ba0311ed0b235e2c97044027168]
@startuml seq_websocket_request_response
!include ../clean.skin

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant "Connection" as conn << (C,#ADD1B2) >>
    participant "ExasolWebsocket" as exaws << (C,#ADD1B2) >>
    participant "Websocket" as ws << (C,#ADD1B2) >>
    participant "Message Handler" as msghandler << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate db

group Initial Connection
    ?-> ws : connect(url)
    create msghandler
    ws -> msghandler : create()
    ws -> luws : wsopen(url, message_handler)
    activate luws
    luws - -> ws : Socket
    deactivate luws
end

client -> conn : execute()
activate conn
conn -> exaws : send_execute()
activate exaws
exaws -> exaws : Encode JSON payload
exaws -> ws : send_raw(json_payload)
activate ws
ws -> luws : wssend(socket, payload)
activate luws
luws -> luws : Encode\nWebsocket frame
luws -> db : socket:send()
activate db
luws - -> ws
deactivate luws
group Wait for response
    db -> db : Process statement
    loop until data received
        'activate luws
        ws -> luws : wsreceive(socket)
        activate luws
        luws - -> ws : no data available
    end
    db -> luws: Response
    deactivate db
    activate luws
    deactivate luws
    luws -> luws : Decode\nWebsocket frame
    luws -> msghandler : Message received
    activate msghandler
    msghandler -> msghandler : Store message
    msghandler - -> luws
    deactivate msghandler
    deactivate luws
    luws - -> ws : data available
    deactivate luws
end

ws -> msghandler : get_data()
activate msghandler
msghandler - -> ws
deactivate msghandler
ws - -> exaws : Response payload
deactivate ws
exaws -> exaws : Decode JSON payload,\ncheck for exception
exaws - -> conn : result set
deactivate exaws
conn - -> client : cursor
deactivate conn

@enduml

@startuml seq_websocket_request_response
hide empty methods
hide empty attributes
skinparam style strictuml
skinparam classAttributeIconSize 0
!pragma horizontalLineBetweenDifferentPackageAllowed

skinparam defaultFontName Calibri

skinparam padding 2

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant "Connection" as conn << (C,#ADD1B2) >>
    participant "ExasolWebsocket" as exaws << (C,#ADD1B2) >>
    participant "Websocket" as ws << (C,#ADD1B2) >>
    participant "Message Handler" as msghandler << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate db

group Initial Connection
    ?-> ws : connect(url)
    create msghandler
    ws -> msghandler : create()
    ws -> luws : wsopen(url, message_handler)
    activate luws
    luws - -> ws : Socket
    deactivate luws
end

client -> conn : execute()
activate conn
conn -> exaws : send_execute()
activate exaws
exaws -> exaws : Encode JSON payload
exaws -> ws : send_raw(json_payload)
activate ws
ws -> luws : wssend(socket, payload)
activate luws
luws -> luws : Encode\nWebsocket frame
luws -> db : socket:send()
activate db
luws - -> ws
deactivate luws
group Wait for response
    db -> db : Process statement
    loop until data received
        ws -> luws : wsreceive(socket)
        activate luws
        luws - -> ws : no data available
    end
    db -> luws: Response
    deactivate db
    activate luws
    deactivate luws
    luws -> luws : Decode\nWebsocket frame
    luws -> msghandler : Message received
    activate msghandler
    msghandler -> msghandler : Store message
    msghandler - -> luws
    deactivate msghandler
    deactivate luws
    luws - -> ws : data available
    deactivate luws
end

ws -> msghandler : get_data()
activate msghandler
msghandler - -> ws
deactivate msghandler
ws - -> exaws : Response payload
deactivate ws
exaws -> exaws : Decode JSON payload,\ncheck for exception
exaws - -> conn : result set
deactivate exaws
conn - -> client : cursor
deactivate conn

@enduml

PlantUML version 1.2022.2(Sat Mar 05 17:30:19 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>