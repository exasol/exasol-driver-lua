<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1200px" preserveAspectRatio="none" style="width:1145px;height:1200px;background:#FFFFFF;" version="1.1" viewBox="0 0 1145 1200" width="1145px" zoomAndPan="magnify"><defs/><g><rect height="46.9766" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="324" x="412" y="10"/><text fill="#000000" font-family="Calibri" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="310" x="419" y="30.5352">Detailed Websocket Request and Response</text><text fill="#000000" font-family="Calibri" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="269" x="439.5" y="47.0234">(Example request: execute statement)</text><rect fill="#DDDDDD" height="1123.627" style="stroke:#181818;stroke-width:0.5;" width="811" x="109" y="63.9766"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="444" y="78.5449">Exasol Driver for Lua</text><rect fill="#FFFFFF" height="1035.3398" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="149.2637"/><rect fill="#FFFFFF" height="818.7871" style="stroke:#181818;stroke-width:1.0;" width="10" x="170.5" y="356.8164"/><rect fill="#FFFFFF" height="752.166" style="stroke:#181818;stroke-width:1.0;" width="10" x="325" y="390.127"/><rect fill="#FFFFFF" height="577.6133" style="stroke:#181818;stroke-width:1.0;" width="10" x="508" y="469.748"/><rect fill="#FFFFFF" height="60.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="899.4297"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="1000.0508"/><rect fill="#FFFFFF" height="33.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="283.1953"/><rect fill="#FFFFFF" height="108.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="503.0586"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="750.1875"/><rect fill="#FFFFFF" height="155.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="804.498"/><rect fill="#FFFFFF" height="1035.3398" style="stroke:#181818;stroke-width:1.0;" width="10" x="986" y="149.2637"/><rect fill="#FFFFFF" height="206.5078" style="stroke:#181818;stroke-width:1.0;" width="10" x="991" y="597.9902"/><rect height="168.2422" style="stroke:#000000;stroke-width:1.5;fill:none;" width="513" x="413" y="156.2637"/><rect height="340.75" style="stroke:#000000;stroke-width:1.5;fill:none;" width="705.5" x="433.5" y="626.9902"/><rect height="70.5762" style="stroke:#000000;stroke-width:1.5;fill:none;" width="482.5" x="443.5" y="701.6113"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="139.2637" y2="1193.6035"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="175" x2="175" y1="139.2637" y2="1193.6035"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="330" x2="330" y1="139.2637" y2="1193.6035"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="512.5" x2="512.5" y1="139.2637" y2="1193.6035"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="668" x2="668" y1="244.3848" y2="1193.6035"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="838" x2="838" y1="139.2637" y2="1193.6035"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="991" x2="991" y1="139.2637" y2="1193.6035"/><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="5" y="87.2871"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="71" x="18.5" y="109.8223">«external»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="80" x="14" y="126.3105">Client Code</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="113" y="102.2637"/><ellipse cx="131" cy="120.2637" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M133.4731,126.4067 Q132.8921,126.7056 132.2529,126.855 Q131.6138,127.0044 130.9082,127.0044 Q128.4014,127.0044 127.0815,125.3525 Q125.7617,123.7007 125.7617,120.5796 Q125.7617,117.4502 127.0815,115.7983 Q128.4014,114.1465 130.9082,114.1465 Q131.6138,114.1465 132.2612,114.2959 Q132.9087,114.4453 133.4731,114.7441 L133.4731,117.4668 Q132.8423,116.8857 132.2488,116.616 Q131.6553,116.3462 131.0244,116.3462 Q129.6797,116.3462 128.9949,117.4128 Q128.3101,118.4795 128.3101,120.5796 Q128.3101,122.6714 128.9949,123.738 Q129.6797,124.8047 131.0244,124.8047 Q131.6553,124.8047 132.2488,124.5349 Q132.8423,124.2651 133.4731,123.6841 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="79" x="150" y="124.7988">Connection</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="248" y="102.2637"/><ellipse cx="266" cy="120.2637" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M268.4731,126.4067 Q267.8921,126.7056 267.2529,126.855 Q266.6138,127.0044 265.9082,127.0044 Q263.4014,127.0044 262.0815,125.3525 Q260.7617,123.7007 260.7617,120.5796 Q260.7617,117.4502 262.0815,115.7983 Q263.4014,114.1465 265.9082,114.1465 Q266.6138,114.1465 267.2612,114.2959 Q267.9087,114.4453 268.4731,114.7441 L268.4731,117.4668 Q267.8423,116.8857 267.2488,116.616 Q266.6553,116.3462 266.0244,116.3462 Q264.6797,116.3462 263.9949,117.4128 Q263.3101,118.4795 263.3101,120.5796 Q263.3101,122.6714 263.9949,123.738 Q264.6797,124.8047 266.0244,124.8047 Q266.6553,124.8047 267.2488,124.5349 Q267.8423,124.2651 268.4731,123.6841 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="118" x="285" y="124.7988">ExasolWebsocket</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="453.5" y="102.2637"/><ellipse cx="471.5" cy="120.2637" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M473.9731,126.4067 Q473.3921,126.7056 472.7529,126.855 Q472.1138,127.0044 471.4082,127.0044 Q468.9014,127.0044 467.5815,125.3525 Q466.2617,123.7007 466.2617,120.5796 Q466.2617,117.4502 467.5815,115.7983 Q468.9014,114.1465 471.4082,114.1465 Q472.1138,114.1465 472.7612,114.2959 Q473.4087,114.4453 473.9731,114.7441 L473.9731,117.4668 Q473.3423,116.8857 472.7488,116.616 Q472.1553,116.3462 471.5244,116.3462 Q470.1797,116.3462 469.4949,117.4128 Q468.8101,118.4795 468.8101,120.5796 Q468.8101,122.6714 469.4949,123.738 Q470.1797,124.8047 471.5244,124.8047 Q472.1553,124.8047 472.7488,124.5349 Q473.3423,124.2651 473.9731,123.6841 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="73" x="490.5" y="124.7988">Websocket</text><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="760" y="87.2871"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="138" x="769" y="109.8223">«Third party library»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="85" x="795.5" y="126.3105">LuWS Socket</text><rect fill="#E2E2F0" height="34.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="926" y="103.7754"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="112" x="935" y="126.3105">Exasol Database</text><rect fill="#FFFFFF" height="1035.3398" style="stroke:#181818;stroke-width:1.0;" width="10" x="49" y="149.2637"/><rect fill="#FFFFFF" height="818.7871" style="stroke:#181818;stroke-width:1.0;" width="10" x="170.5" y="356.8164"/><rect fill="#FFFFFF" height="752.166" style="stroke:#181818;stroke-width:1.0;" width="10" x="325" y="390.127"/><rect fill="#FFFFFF" height="577.6133" style="stroke:#181818;stroke-width:1.0;" width="10" x="508" y="469.748"/><rect fill="#FFFFFF" height="60.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="899.4297"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="1000.0508"/><rect fill="#FFFFFF" height="33.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="283.1953"/><rect fill="#FFFFFF" height="108.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="503.0586"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="750.1875"/><rect fill="#FFFFFF" height="155.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="833" y="804.498"/><rect fill="#FFFFFF" height="1035.3398" style="stroke:#181818;stroke-width:1.0;" width="10" x="986" y="149.2637"/><rect fill="#FFFFFF" height="206.5078" style="stroke:#181818;stroke-width:1.0;" width="10" x="991" y="597.9902"/><path d="M413,156.2637 L580,156.2637 L580,167.5742 L570,177.5742 L413,177.5742 L413,156.2637 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="168.2422" style="stroke:#000000;stroke-width:1.5;" width="513" x="413" y="156.2637"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="430" y="171.832">Initial Connection</text><polygon fill="#181818" points="501,198.8848,511,202.8848,501,206.8848" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="410" x2="507" y1="202.8848" y2="202.8848"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="75" x="419" y="196.1426">connect(url)</text><polygon fill="#181818" points="575,232.1953,585,236.1953,575,240.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="513" x2="581" y1="236.1953" y2="236.1953"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="46" x="522" y="229.4531">create()</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="587" y="210.8848"/><ellipse cx="605" cy="228.8848" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M607.4731,235.0278 Q606.8921,235.3267 606.2529,235.4761 Q605.6138,235.6255 604.9082,235.6255 Q602.4014,235.6255 601.0815,233.9736 Q599.7617,232.3218 599.7617,229.2007 Q599.7617,226.0713 601.0815,224.4194 Q602.4014,222.7676 604.9082,222.7676 Q605.6138,222.7676 606.2612,222.917 Q606.9087,223.0664 607.4731,223.3652 L607.4731,226.0879 Q606.8423,225.5068 606.2488,225.2371 Q605.6553,224.9673 605.0244,224.9673 Q603.6797,224.9673 602.9949,226.0339 Q602.3101,227.1006 602.3101,229.2007 Q602.3101,231.2925 602.9949,232.3591 Q603.6797,233.4258 605.0244,233.4258 Q605.6553,233.4258 606.2488,233.156 Q606.8423,232.8862 607.4731,232.3052 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="117" x="624" y="233.4199">Message Handler</text><polygon fill="#181818" points="821,279.1953,831,283.1953,821,287.1953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="513" x2="827" y1="283.1953" y2="283.1953"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="190" x="522" y="276.4531">wsopen(url, message_handler)</text><polygon fill="#181818" points="524,312.5059,514,316.5059,524,320.5059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="518" x2="837" y1="316.5059" y2="316.5059"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="42" x="532" y="309.7637">Socket</text><polygon fill="#181818" points="158.5,352.8164,168.5,356.8164,158.5,360.8164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="59" x2="164.5" y1="356.8164" y2="356.8164"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="57" x="68" y="350.0742">execute()</text><polygon fill="#181818" points="313,386.127,323,390.127,313,394.127" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="180.5" x2="319" y1="390.127" y2="390.127"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="94" x="189.5" y="383.3848">send_execute()</text><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="377" y1="423.4375" y2="423.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="377" y1="423.4375" y2="436.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="377" y1="436.4375" y2="436.4375"/><polygon fill="#181818" points="346,432.4375,336,436.4375,346,440.4375" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="133" x="344" y="416.6953">Encode JSON payload</text><polygon fill="#181818" points="496,465.748,506,469.748,496,473.748" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="502" y1="469.748" y2="469.748"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="150" x="344" y="463.0059">send_raw(json_payload)</text><polygon fill="#181818" points="821,499.0586,831,503.0586,821,507.0586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="518" x2="827" y1="503.0586" y2="503.0586"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="154" x="527" y="496.3164">wssend(socket, payload)</text><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="885" y1="551.6797" y2="551.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="885" x2="885" y1="551.6797" y2="564.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="844" x2="885" y1="564.6797" y2="564.6797"/><polygon fill="#181818" points="854,560.6797,844,564.6797,854,568.6797" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="45" x="852" y="529.627">Encode</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="108" x="852" y="544.9375">Websocket frame</text><polygon fill="#181818" points="979,593.9902,989,597.9902,979,601.9902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="985" y1="597.9902" y2="597.9902"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="84" x="852" y="591.248">socket:send()</text><polygon fill="#181818" points="529,607.9902,519,611.9902,529,615.9902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="837" y1="611.9902" y2="611.9902"/><path d="M433.5,626.9902 L600.5,626.9902 L600.5,638.3008 L590.5,648.3008 L433.5,648.3008 L433.5,626.9902 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="340.75" style="stroke:#000000;stroke-width:1.5;" width="705.5" x="433.5" y="626.9902"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="450.5" y="642.5586">Wait for response</text><line style="stroke:#181818;stroke-width:1.0;" x1="1001" x2="1043" y1="673.6113" y2="673.6113"/><line style="stroke:#181818;stroke-width:1.0;" x1="1043" x2="1043" y1="673.6113" y2="686.6113"/><line style="stroke:#181818;stroke-width:1.0;" x1="1002" x2="1043" y1="686.6113" y2="686.6113"/><polygon fill="#181818" points="1012,682.6113,1002,686.6113,1012,690.6113" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="115" x="1010" y="666.8691">Process statement</text><path d="M443.5,701.6113 L521.5,701.6113 L521.5,712.9219 L511.5,722.9219 L443.5,722.9219 L443.5,701.6113 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="70.5762" style="stroke:#000000;stroke-width:1.5;" width="482.5" x="443.5" y="701.6113"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="460.5" y="717.1797">loop</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112" x="538.5" y="716.2461">[until data received]</text><polygon fill="#181818" points="821,746.1875,831,750.1875,821,754.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="518" x2="827" y1="750.1875" y2="750.1875"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="111" x="527" y="743.4453">wsreceive(socket)</text><polygon fill="#181818" points="529,760.1875,519,764.1875,529,768.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="837" y1="764.1875" y2="764.1875"/><polygon fill="#181818" points="854,800.498,844,804.498,854,808.498" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="848" x2="985" y1="804.498" y2="804.498"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="60" x="862" y="797.7559">Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="843" x2="885" y1="853.1191" y2="853.1191"/><line style="stroke:#181818;stroke-width:1.0;" x1="885" x2="885" y1="853.1191" y2="866.1191"/><line style="stroke:#181818;stroke-width:1.0;" x1="844" x2="885" y1="866.1191" y2="866.1191"/><polygon fill="#181818" points="854,862.1191,844,866.1191,854,870.1191" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="47" x="852" y="831.0664">Decode</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="108" x="852" y="846.377">Websocket frame</text><polygon fill="#181818" points="684.5,895.4297,674.5,899.4297,684.5,903.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="678.5" x2="832" y1="899.4297" y2="899.4297"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="110" x="692.5" y="892.6875">Message received</text><line style="stroke:#181818;stroke-width:1.0;" x1="673.5" x2="715.5" y1="932.7402" y2="932.7402"/><line style="stroke:#181818;stroke-width:1.0;" x1="715.5" x2="715.5" y1="932.7402" y2="945.7402"/><line style="stroke:#181818;stroke-width:1.0;" x1="674.5" x2="715.5" y1="945.7402" y2="945.7402"/><polygon fill="#181818" points="684.5,941.7402,674.5,945.7402,684.5,949.7402" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="91" x="682.5" y="925.998">Store message</text><polygon fill="#181818" points="826,955.7402,836,959.7402,826,963.7402" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="668.5" x2="832" y1="959.7402" y2="959.7402"/><polygon fill="#181818" points="651.5,996.0508,661.5,1000.0508,651.5,1004.0508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="518" x2="657.5" y1="1000.0508" y2="1000.0508"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="62" x="527" y="993.3086">get_data()</text><polygon fill="#181818" points="529,1010.0508,519,1014.0508,529,1018.0508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="523" x2="667.5" y1="1014.0508" y2="1014.0508"/><polygon fill="#181818" points="346,1043.3613,336,1047.3613,346,1051.3613" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="340" x2="512" y1="1047.3613" y2="1047.3613"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="113" x="354" y="1040.6191">Response payload</text><line style="stroke:#181818;stroke-width:1.0;" x1="335" x2="377" y1="1095.9824" y2="1095.9824"/><line style="stroke:#181818;stroke-width:1.0;" x1="377" x2="377" y1="1095.9824" y2="1108.9824"/><line style="stroke:#181818;stroke-width:1.0;" x1="336" x2="377" y1="1108.9824" y2="1108.9824"/><polygon fill="#181818" points="346,1104.9824,336,1108.9824,346,1112.9824" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="139" x="344" y="1073.9297">Decode JSON payload,</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="125" x="344" y="1089.2402">check for exception</text><polygon fill="#181818" points="191.5,1138.293,181.5,1142.293,191.5,1146.293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="185.5" x2="329" y1="1142.293" y2="1142.293"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="59" x="199.5" y="1135.5508">result set</text><polygon fill="#181818" points="70,1171.6035,60,1175.6035,70,1179.6035" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64" x2="174.5" y1="1175.6035" y2="1175.6035"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="40" x="78" y="1168.8613">cursor</text><!--MD5=[32742b3c9dba2ed59d2c11b931cc122e]
@startuml seq_websocket_request_response
!include ../clean.skin

title: Detailed Websocket Request and Response\n(Example request: execute statement)

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant "Connection" as conn << (C,#ADD1B2) >>
    participant "ExasolWebsocket" as exaws << (C,#ADD1B2) >>
    participant "Websocket" as ws << (C,#ADD1B2) >>
    participant "Message Handler" as msghandler << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate db

group Initial Connection
    ?-> ws : connect(url)
    create msghandler
    ws -> msghandler : create()
    ws -> luws : wsopen(url, message_handler)
    activate luws
    luws - -> ws : Socket
    deactivate luws
end

client -> conn : execute()
activate conn
conn -> exaws : send_execute()
activate exaws
exaws -> exaws : Encode JSON payload
exaws -> ws : send_raw(json_payload)
activate ws
ws -> luws : wssend(socket, payload)
activate luws
luws -> luws : Encode\nWebsocket frame
luws -> db : socket:send()
activate db
luws - -> ws
deactivate luws
group Wait for response
    db -> db : Process statement
    loop until data received
        ws -> luws : wsreceive(socket)
        activate luws
        luws - -> ws
        deactivate luws
    end
    db -> luws: Response
    deactivate db
    activate luws
    luws -> luws : Decode\nWebsocket frame
    luws -> msghandler : Message received
    activate msghandler
    msghandler -> msghandler : Store message
    msghandler - -> luws
    deactivate msghandler
    deactivate luws
end

ws -> msghandler : get_data()
activate msghandler
msghandler - -> ws
deactivate msghandler
ws - -> exaws : Response payload
deactivate ws
exaws -> exaws : Decode JSON payload,\ncheck for exception
exaws - -> conn : result set
deactivate exaws
conn - -> client : cursor
deactivate conn

@enduml

@startuml seq_websocket_request_response
hide empty methods
hide empty attributes
skinparam style strictuml
skinparam classAttributeIconSize 0
!pragma horizontalLineBetweenDifferentPackageAllowed

skinparam defaultFontName Calibri

skinparam padding 2

title: Detailed Websocket Request and Response\n(Example request: execute statement)

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant "Connection" as conn << (C,#ADD1B2) >>
    participant "ExasolWebsocket" as exaws << (C,#ADD1B2) >>
    participant "Websocket" as ws << (C,#ADD1B2) >>
    participant "Message Handler" as msghandler << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate db

group Initial Connection
    ?-> ws : connect(url)
    create msghandler
    ws -> msghandler : create()
    ws -> luws : wsopen(url, message_handler)
    activate luws
    luws - -> ws : Socket
    deactivate luws
end

client -> conn : execute()
activate conn
conn -> exaws : send_execute()
activate exaws
exaws -> exaws : Encode JSON payload
exaws -> ws : send_raw(json_payload)
activate ws
ws -> luws : wssend(socket, payload)
activate luws
luws -> luws : Encode\nWebsocket frame
luws -> db : socket:send()
activate db
luws - -> ws
deactivate luws
group Wait for response
    db -> db : Process statement
    loop until data received
        ws -> luws : wsreceive(socket)
        activate luws
        luws - -> ws
        deactivate luws
    end
    db -> luws: Response
    deactivate db
    activate luws
    luws -> luws : Decode\nWebsocket frame
    luws -> msghandler : Message received
    activate msghandler
    msghandler -> msghandler : Store message
    msghandler - -> luws
    deactivate msghandler
    deactivate luws
end

ws -> msghandler : get_data()
activate msghandler
msghandler - -> ws
deactivate msghandler
ws - -> exaws : Response payload
deactivate ws
exaws -> exaws : Decode JSON payload,\ncheck for exception
exaws - -> conn : result set
deactivate exaws
conn - -> client : cursor
deactivate conn

@enduml

PlantUML version 1.2022.2(Sat Mar 05 17:30:19 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>