<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="510px" preserveAspectRatio="none" style="width:789px;height:510px;background:#FFFFFF;" version="1.1" viewBox="0 0 789 510" width="789px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="251.4629" style="stroke:#181818;stroke-width:1.0;" width="10" x="322" y="174.9961"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="536" y="251.5273"/><rect fill="#FFFFFF" height="427.9258" style="stroke:#181818;stroke-width:1.0;" width="10" x="693" y="66.9766"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="698" y="265.5273"/><rect height="308.0391" style="stroke:#000000;stroke-width:1.5;fill:none;" width="773" x="10" y="126.4199"/><rect height="157.8418" style="stroke:#000000;stroke-width:1.5;fill:none;" width="502.5" x="270.5" y="189.9961"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="69" x2="69" y1="56.9766" y2="503.9023"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="190" x2="190" y1="56.9766" y2="503.9023"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="326.5" x2="326.5" y1="56.9766" y2="503.9023"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="541" x2="541" y1="56.9766" y2="503.9023"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="698" x2="698" y1="56.9766" y2="503.9023"/><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="20" y="5"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="71" x="33.5" y="27.5352">«external»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="80" x="29" y="44.0234">Client Code</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="128" y="19.9766"/><ellipse cx="146" cy="37.9766" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M148.4731,44.1196 Q147.8921,44.4185 147.2529,44.5679 Q146.6138,44.7173 145.9082,44.7173 Q143.4014,44.7173 142.0815,43.0654 Q140.7617,41.4136 140.7617,38.2925 Q140.7617,35.1631 142.0815,33.5112 Q143.4014,31.8594 145.9082,31.8594 Q146.6138,31.8594 147.2612,32.0088 Q147.9087,32.1582 148.4731,32.457 L148.4731,35.1797 Q147.8423,34.5986 147.2488,34.3289 Q146.6553,34.0591 146.0244,34.0591 Q144.6797,34.0591 143.9949,35.1257 Q143.3101,36.1924 143.3101,38.2925 Q143.3101,40.3843 143.9949,41.4509 Q144.6797,42.5176 146.0244,42.5176 Q146.6553,42.5176 147.2488,42.2478 Q147.8423,41.978 148.4731,41.397 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="79" x="165" y="42.5117">Connection</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93" x="280.5" y="19.9766"/><ellipse cx="298.5" cy="37.9766" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M300.9731,44.1196 Q300.3921,44.4185 299.7529,44.5679 Q299.1138,44.7173 298.4082,44.7173 Q295.9014,44.7173 294.5815,43.0654 Q293.2617,41.4136 293.2617,38.2925 Q293.2617,35.1631 294.5815,33.5112 Q295.9014,31.8594 298.4082,31.8594 Q299.1138,31.8594 299.7612,32.0088 Q300.4087,32.1582 300.9731,32.457 L300.9731,35.1797 Q300.3423,34.5986 299.7488,34.3289 Q299.1553,34.0591 298.5244,34.0591 Q297.1797,34.0591 296.4949,35.1257 Q295.8101,36.1924 295.8101,38.2925 Q295.8101,40.3843 296.4949,41.4509 Q297.1797,42.5176 298.5244,42.5176 Q299.1553,42.5176 299.7488,42.2478 Q300.3423,41.978 300.9731,41.397 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="47" x="317.5" y="42.5117">Cursor</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="459" y="19.9766"/><ellipse cx="477" cy="37.9766" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M479.4731,44.1196 Q478.8921,44.4185 478.2529,44.5679 Q477.6138,44.7173 476.9082,44.7173 Q474.4014,44.7173 473.0815,43.0654 Q471.7617,41.4136 471.7617,38.2925 Q471.7617,35.1631 473.0815,33.5112 Q474.4014,31.8594 476.9082,31.8594 Q477.6138,31.8594 478.2612,32.0088 Q478.9087,32.1582 479.4731,32.457 L479.4731,35.1797 Q478.8423,34.5986 478.2488,34.3289 Q477.6553,34.0591 477.0244,34.0591 Q475.6797,34.0591 474.9949,35.1257 Q474.3101,36.1924 474.3101,38.2925 Q474.3101,40.3843 474.9949,41.4509 Q475.6797,42.5176 477.0244,42.5176 Q477.6553,42.5176 478.2488,42.2478 Q478.8423,41.978 479.4731,41.397 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="118" x="496" y="42.5117">ExasolWebsocket</text><rect fill="#E2E2F0" height="34.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="633" y="21.4883"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="112" x="642" y="44.0234">Exasol Database</text><rect fill="#FFFFFF" height="251.4629" style="stroke:#181818;stroke-width:1.0;" width="10" x="322" y="174.9961"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="536" y="251.5273"/><rect fill="#FFFFFF" height="427.9258" style="stroke:#181818;stroke-width:1.0;" width="10" x="693" y="66.9766"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="698" y="265.5273"/><rect height="47.4434" style="stroke:#000000;stroke-width:1.5;fill:none;" width="359.5" x="17" y="66.9766"/><path d="M17,66.9766 L85,66.9766 L85,77.9766 L75,87.9766 L17,87.9766 L17,66.9766 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="32" y="83.5449">ref</text><text fill="#000000" font-family="Calibri" font-size="12" lengthAdjust="spacing" textLength="321" x="36.25" y="105.5781">Use connection to execute a statement and get a cursor</text><path d="M10,126.4199 L88,126.4199 L88,137.7305 L78,147.7305 L10,147.7305 L10,126.4199 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="308.0391" style="stroke:#000000;stroke-width:1.5;" width="773" x="10" y="126.4199"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="27" y="141.9883">loop</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="212" x="105" y="141.0547">[Fetch results until fetch() returns nil]</text><polygon fill="#181818" points="310,170.9961,320,174.9961,310,178.9961" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="69" x2="316" y1="174.9961" y2="174.9961"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="40" x="78" y="168.2539">fetch()</text><path d="M270.5,189.9961 L336.5,189.9961 L336.5,201.3066 L326.5,211.3066 L270.5,211.3066 L270.5,189.9961 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="157.8418" style="stroke:#000000;stroke-width:1.5;" width="502.5" x="270.5" y="189.9961"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="287.5" y="205.5645">alt</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="353.5" y="204.6309">[If DB has returned a resultset handle</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="228" x="353.5" y="217.5859">and no more rows available in local list]</text><polygon fill="#181818" points="524,247.5273,534,251.5273,524,255.5273" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="332" x2="530" y1="251.5273" y2="251.5273"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="181" x="341" y="244.7852">send_fetch(resultset_handle)</text><polygon fill="#181818" points="686,261.5273,696,265.5273,686,269.5273" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="546" x2="692" y1="265.5273" y2="265.5273"/><polygon fill="#181818" points="557,275.5273,547,279.5273,557,283.5273" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="551" x2="692" y1="279.5273" y2="279.5273"/><polygon fill="#181818" points="343,289.5273,333,293.5273,343,297.5273" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="337" x2="540" y1="293.5273" y2="293.5273"/><line style="stroke:#181818;stroke-width:1.0;" x1="332" x2="374" y1="326.8379" y2="326.8379"/><line style="stroke:#181818;stroke-width:1.0;" x1="374" x2="374" y1="326.8379" y2="339.8379"/><line style="stroke:#181818;stroke-width:1.0;" x1="333" x2="374" y1="339.8379" y2="339.8379"/><polygon fill="#181818" points="343,335.8379,333,339.8379,343,343.8379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="137" x="341" y="320.0957">Store data in local list</text><line style="stroke:#181818;stroke-width:1.0;" x1="332" x2="374" y1="380.1484" y2="380.1484"/><line style="stroke:#181818;stroke-width:1.0;" x1="374" x2="374" y1="380.1484" y2="393.1484"/><line style="stroke:#181818;stroke-width:1.0;" x1="333" x2="374" y1="393.1484" y2="393.1484"/><polygon fill="#181818" points="343,389.1484,333,393.1484,343,397.1484" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="172" x="341" y="373.4063">Get next row from local list</text><polygon fill="#181818" points="80,422.459,70,426.459,80,430.459" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="74" x2="326" y1="426.459" y2="426.459"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="225" x="88" y="419.7168">Row or nil if no more rows available</text><rect height="47.4434" style="stroke:#000000;stroke-width:1.5;fill:none;" width="359.5" x="17" y="441.459"/><path d="M17,441.459 L85,441.459 L85,452.459 L75,462.459 L17,462.459 L17,441.459 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="32" y="458.0273">ref</text><text fill="#000000" font-family="Calibri" font-size="12" lengthAdjust="spacing" textLength="71" x="161.25" y="480.0605">Close cursor</text><!--MD5=[4feff22ba7fcab3869a2cc114fdef073]
@startuml seq_cursor_fetch
!include ../clean.skin

participant "Client Code" as client <<external>>
participant Connection as conn << (C,#ADD1B2) >>
participant Cursor as cur << (C,#ADD1B2) >>
participant ExasolWebsocket as ws << (C,#ADD1B2) >>
participant "Exasol Database" as db

activate db

ref over client, cur: Use connection to execute a statement and get a cursor

loop Fetch results until fetch() returns nil
    ' [dsn -> req~luasql-cursor-fetch~1 >> impl,utest,itest]
    client -> cur: fetch()
    activate cur
    ' [dsn -> req~luasql-cursor-fetch-resultsethandle~1 >> impl,utest,itest]
    alt If DB has returned a resultset handle\nand no more rows available in local list
        cur -> ws : send_fetch(resultset_handle)
        activate ws
        ws -> db
        activate db
        db - -> ws
        deactivate db
        ws - -> cur
        deactivate ws
        cur -> cur : Store data in local list
    end
    cur -> cur : Get next row from local list
    cur - -> client : Row or nil if no more rows available
    deactivate cur
end

ref over client, cur: Close cursor

@enduml

@startuml seq_cursor_fetch
hide empty methods
hide empty attributes
skinparam style strictuml
skinparam classAttributeIconSize 0
!pragma horizontalLineBetweenDifferentPackageAllowed

skinparam defaultFontName Calibri

skinparam padding 2

participant "Client Code" as client <<external>>
participant Connection as conn << (C,#ADD1B2) >>
participant Cursor as cur << (C,#ADD1B2) >>
participant ExasolWebsocket as ws << (C,#ADD1B2) >>
participant "Exasol Database" as db

activate db

ref over client, cur: Use connection to execute a statement and get a cursor

loop Fetch results until fetch() returns nil
    client -> cur: fetch()
    activate cur
    alt If DB has returned a resultset handle\nand no more rows available in local list
        cur -> ws : send_fetch(resultset_handle)
        activate ws
        ws -> db
        activate db
        db - -> ws
        deactivate db
        ws - -> cur
        deactivate ws
        cur -> cur : Store data in local list
    end
    cur -> cur : Get next row from local list
    cur - -> client : Row or nil if no more rows available
    deactivate cur
end

ref over client, cur: Close cursor

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>