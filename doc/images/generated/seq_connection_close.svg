<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="741px" preserveAspectRatio="none" style="width:982px;height:741px;background:#FFFFFF;" version="1.1" viewBox="0 0 982 741" width="982px" zoomAndPan="magnify"><defs/><g><rect fill="#DDDDDD" height="722.8105" style="stroke:#181818;stroke-width:0.5;" width="705" x="124" y="6"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="141" x="406" y="20.5684">Exasol Driver for Lua</text><rect fill="#FFFFFF" height="634.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="64" y="91.2871"/><rect fill="#FFFFFF" height="593.2129" style="stroke:#181818;stroke-width:1.0;" width="10" x="185.5" y="116.5977"/><rect fill="#FFFFFF" height="33.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="304.5" y="180.1738"/><rect fill="#FFFFFF" height="151.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="443" y="336.3262"/><rect fill="#FFFFFF" height="154.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="443" y="521.5684"/><rect fill="#FFFFFF" height="104.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="594.5" y="369.6367"/><rect fill="#FFFFFF" height="107.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="594.5" y="554.8789"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="742" y="418.2578"/><rect fill="#FFFFFF" height="39.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="742" y="588.1895"/><rect fill="#FFFFFF" height="634.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="895" y="91.2871"/><rect height="89.8867" style="stroke:#000000;stroke-width:1.5;fill:none;" width="248" x="118" y="131.5977"/><rect height="482.3262" style="stroke:#000000;stroke-width:1.5;fill:none;" width="965" x="10" y="235.4844"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="69" x2="69" y1="81.2871" y2="734.8105"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="190" x2="190" y1="81.2871" y2="734.8105"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="309" x2="309" y1="81.2871" y2="734.8105"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="448" x2="448" y1="81.2871" y2="734.8105"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="599" x2="599" y1="81.2871" y2="734.8105"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="747" x2="747" y1="81.2871" y2="734.8105"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="900" x2="900" y1="81.2871" y2="734.8105"/><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="20" y="29.3105"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="71" x="33.5" y="51.8457">«external»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="80" x="29" y="68.334">Client Code</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="125" x="128" y="44.2871"/><ellipse cx="146" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M148.4731,68.4302 Q147.8921,68.729 147.2529,68.8784 Q146.6138,69.0278 145.9082,69.0278 Q143.4014,69.0278 142.0815,67.376 Q140.7617,65.7241 140.7617,62.603 Q140.7617,59.4736 142.0815,57.8218 Q143.4014,56.1699 145.9082,56.1699 Q146.6138,56.1699 147.2612,56.3193 Q147.9087,56.4688 148.4731,56.7676 L148.4731,59.4902 Q147.8423,58.9092 147.2488,58.6394 Q146.6553,58.3696 146.0244,58.3696 Q144.6797,58.3696 143.9949,59.4363 Q143.3101,60.5029 143.3101,62.603 Q143.3101,64.6948 143.9949,65.7615 Q144.6797,66.8281 146.0244,66.8281 Q146.6553,66.8281 147.2488,66.5583 Q147.8423,66.2886 148.4731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="79" x="165" y="66.8223">Connection</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93" x="263" y="44.2871"/><ellipse cx="281" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M283.4731,68.4302 Q282.8921,68.729 282.2529,68.8784 Q281.6138,69.0278 280.9082,69.0278 Q278.4014,69.0278 277.0815,67.376 Q275.7617,65.7241 275.7617,62.603 Q275.7617,59.4736 277.0815,57.8218 Q278.4014,56.1699 280.9082,56.1699 Q281.6138,56.1699 282.2612,56.3193 Q282.9087,56.4688 283.4731,56.7676 L283.4731,59.4902 Q282.8423,58.9092 282.2488,58.6394 Q281.6553,58.3696 281.0244,58.3696 Q279.6797,58.3696 278.9949,59.4363 Q278.3101,60.5029 278.3101,62.603 Q278.3101,64.6948 278.9949,65.7615 Q279.6797,66.8281 281.0244,66.8281 Q281.6553,66.8281 282.2488,66.5583 Q282.8423,66.2886 283.4731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="47" x="300" y="66.8223">Cursor</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="366" y="44.2871"/><ellipse cx="384" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M386.4731,68.4302 Q385.8921,68.729 385.2529,68.8784 Q384.6138,69.0278 383.9082,69.0278 Q381.4014,69.0278 380.0815,67.376 Q378.7617,65.7241 378.7617,62.603 Q378.7617,59.4736 380.0815,57.8218 Q381.4014,56.1699 383.9082,56.1699 Q384.6138,56.1699 385.2612,56.3193 Q385.9087,56.4688 386.4731,56.7676 L386.4731,59.4902 Q385.8423,58.9092 385.2488,58.6394 Q384.6553,58.3696 384.0244,58.3696 Q382.6797,58.3696 381.9949,59.4363 Q381.3101,60.5029 381.3101,62.603 Q381.3101,64.6948 381.9949,65.7615 Q382.6797,66.8281 384.0244,66.8281 Q384.6553,66.8281 385.2488,66.5583 Q385.8423,66.2886 386.4731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="118" x="403" y="66.8223">ExasolWebsocket</text><rect fill="#E2E2F0" height="36" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="540" y="44.2871"/><ellipse cx="558" cy="62.2871" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M560.4731,68.4302 Q559.8921,68.729 559.2529,68.8784 Q558.6138,69.0278 557.9082,69.0278 Q555.4014,69.0278 554.0815,67.376 Q552.7617,65.7241 552.7617,62.603 Q552.7617,59.4736 554.0815,57.8218 Q555.4014,56.1699 557.9082,56.1699 Q558.6138,56.1699 559.2612,56.3193 Q559.9087,56.4688 560.4731,56.7676 L560.4731,59.4902 Q559.8423,58.9092 559.2488,58.6394 Q558.6553,58.3696 558.0244,58.3696 Q556.6797,58.3696 555.9949,59.4363 Q555.3101,60.5029 555.3101,62.603 Q555.3101,64.6948 555.9949,65.7615 Q556.6797,66.8281 558.0244,66.8281 Q558.6553,66.8281 559.2488,66.5583 Q559.8423,66.2886 560.4731,65.7075 Z " fill="#000000"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="73" x="577" y="66.8223">Websocket</text><rect fill="#E2E2F0" height="50.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="669" y="29.3105"/><text fill="#000000" font-family="Calibri" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="138" x="678" y="51.8457">«Third party library»</text><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="85" x="704.5" y="68.334">LuWS Socket</text><rect fill="#E2E2F0" height="34.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130" x="835" y="45.7988"/><text fill="#000000" font-family="Calibri" font-size="14" lengthAdjust="spacing" textLength="112" x="844" y="68.334">Exasol Database</text><rect fill="#FFFFFF" height="634.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="64" y="91.2871"/><rect fill="#FFFFFF" height="593.2129" style="stroke:#181818;stroke-width:1.0;" width="10" x="185.5" y="116.5977"/><rect fill="#FFFFFF" height="33.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="304.5" y="180.1738"/><rect fill="#FFFFFF" height="151.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="443" y="336.3262"/><rect fill="#FFFFFF" height="154.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="443" y="521.5684"/><rect fill="#FFFFFF" height="104.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="594.5" y="369.6367"/><rect fill="#FFFFFF" height="107.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="594.5" y="554.8789"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="742" y="418.2578"/><rect fill="#FFFFFF" height="39.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="742" y="588.1895"/><rect fill="#FFFFFF" height="634.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="895" y="91.2871"/><polygon fill="#181818" points="173.5,112.5977,183.5,116.5977,173.5,120.5977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="74" x2="179.5" y1="116.5977" y2="116.5977"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="41" x="83" y="109.8555">close()</text><path d="M118,131.5977 L196,131.5977 L196,142.9082 L186,152.9082 L118,152.9082 L118,131.5977 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="89.8867" style="stroke:#000000;stroke-width:1.5;" width="248" x="118" y="131.5977"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="135" y="147.166">loop</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="89" x="213" y="146.2324">[for all cursors]</text><polygon fill="#181818" points="292.5,176.1738,302.5,180.1738,292.5,184.1738" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="195.5" x2="298.5" y1="180.1738" y2="180.1738"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="41" x="204.5" y="173.4316">closed</text><polygon fill="#181818" points="206.5,209.4844,196.5,213.4844,206.5,217.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="200.5" x2="308.5" y1="213.4844" y2="213.4844"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="56" x="214.5" y="206.7422">is closed</text><path d="M10,235.4844 L76,235.4844 L76,246.7949 L66,256.7949 L10,256.7949 L10,235.4844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="482.3262" style="stroke:#000000;stroke-width:1.5;" width="965" x="10" y="235.4844"/><text fill="#000000" font-family="Calibri" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="27" y="251.0527">alt</text><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="188" x="93" y="250.1191">[at least one cursor is not closed]</text><polygon fill="#181818" points="85,280.0605,75,284.0605,85,288.0605" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="184.5" y1="284.0605" y2="284.0605"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="30" x="93" y="277.3184">false</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="975" y1="293.0605" y2="293.0605"/><text fill="#000000" font-family="Calibri" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="129" x="17" y="305.6953">[all cursors are closed]</text><polygon fill="#181818" points="431,332.3262,441,336.3262,431,340.3262" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="195.5" x2="437" y1="336.3262" y2="336.3262"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="114" x="204.5" y="329.584">send_disconnect()</text><polygon fill="#181818" points="582.5,365.6367,592.5,369.6367,582.5,373.6367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="453" x2="588.5" y1="369.6367" y2="369.6367"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="116" x="462" y="362.8945">send_raw(payload)</text><polygon fill="#181818" points="730,414.2578,740,418.2578,730,422.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="604.5" x2="736" y1="418.2578" y2="418.2578"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="97" x="613.5" y="396.2051">wssend(socket,</text><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="53" x="613.5" y="411.5156">payload)</text><polygon fill="#181818" points="883,428.2578,893,432.2578,883,436.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="752" x2="889" y1="432.2578" y2="432.2578"/><polygon fill="#181818" points="763,442.2578,753,446.2578,763,450.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="757" x2="894" y1="446.2578" y2="446.2578"/><polygon fill="#181818" points="615.5,456.2578,605.5,460.2578,615.5,464.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="609.5" x2="746" y1="460.2578" y2="460.2578"/><polygon fill="#181818" points="464,470.2578,454,474.2578,464,478.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="458" x2="598.5" y1="474.2578" y2="474.2578"/><polygon fill="#181818" points="206.5,484.2578,196.5,488.2578,206.5,492.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="200.5" x2="447" y1="488.2578" y2="488.2578"/><polygon fill="#181818" points="431,517.5684,441,521.5684,431,525.5684" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="195.5" x2="437" y1="521.5684" y2="521.5684"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="41" x="204.5" y="514.8262">close()</text><polygon fill="#181818" points="582.5,550.8789,592.5,554.8789,582.5,558.8789" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="453" x2="588.5" y1="554.8789" y2="554.8789"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="41" x="462" y="548.1367">close()</text><polygon fill="#181818" points="730,584.1895,740,588.1895,730,592.1895" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="604.5" x2="736" y1="588.1895" y2="588.1895"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="100" x="613.5" y="581.4473">wsclose(socket)</text><line style="stroke:#181818;stroke-width:1.0;" x1="752" x2="794" y1="621.5" y2="621.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="794" x2="794" y1="621.5" y2="634.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="753" x2="794" y1="634.5" y2="634.5"/><polygon fill="#181818" points="763,630.5,753,634.5,763,638.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="81" x="761" y="614.7578">Close socket</text><line style="stroke:#A80036;stroke-width:2.0;" x1="738" x2="756" y1="625.5" y2="643.5"/><line style="stroke:#A80036;stroke-width:2.0;" x1="738" x2="756" y1="643.5" y2="625.5"/><polygon fill="#181818" points="615.5,644.5,605.5,648.5,615.5,652.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="609.5" x2="746" y1="648.5" y2="648.5"/><polygon fill="#181818" points="464,658.5,454,662.5,464,666.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="458" x2="598.5" y1="662.5" y2="662.5"/><line style="stroke:#A80036;stroke-width:2.0;" x1="590.5" x2="608.5" y1="653.5" y2="671.5"/><line style="stroke:#A80036;stroke-width:2.0;" x1="590.5" x2="608.5" y1="671.5" y2="653.5"/><polygon fill="#181818" points="206.5,672.5,196.5,676.5,206.5,680.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="200.5" x2="447" y1="676.5" y2="676.5"/><line style="stroke:#A80036;stroke-width:2.0;" x1="439" x2="457" y1="667.5" y2="685.5"/><line style="stroke:#A80036;stroke-width:2.0;" x1="439" x2="457" y1="685.5" y2="667.5"/><polygon fill="#181818" points="85,705.8105,75,709.8105,85,713.8105" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="79" x2="189.5" y1="709.8105" y2="709.8105"/><text fill="#000000" font-family="Calibri" font-size="13" lengthAdjust="spacing" textLength="25" x="93" y="703.0684">true</text><line style="stroke:#A80036;stroke-width:2.0;" x1="181.5" x2="199.5" y1="700.8105" y2="718.8105"/><line style="stroke:#A80036;stroke-width:2.0;" x1="181.5" x2="199.5" y1="718.8105" y2="700.8105"/><!--MD5=[607741cd4f8226d1eb7baec9ff973e55]
@startuml seq_connection_close
!include ../clean.skin

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant Connection as conn << (C,#ADD1B2) >>
    participant Cursor as cur << (C,#ADD1B2) >>
    participant ExasolWebsocket as exaws << (C,#ADD1B2) >>
    participant Websocket as ws << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate db

' [dsn -> req~luasql-connection-close~1 >> impl,itest]
client -> conn : close()
activate conn
loop for all cursors
    conn -> cur : closed
    activate cur
    cur - -> conn: is closed
    deactivate cur
end
alt at least one cursor is not closed
    conn - -> client: false
else all cursors are closed
    conn -> exaws : send_disconnect()
    activate exaws
    exaws -> ws : send_raw(payload)
    activate ws
    ws -> luws : wssend(socket,\npayload)
    activate luws
    luws -> db
    db - -> luws
    luws - -> ws
    deactivate luws
    ws - -> exaws
    deactivate ws
    exaws - -> conn
    deactivate exaws
    conn -> exaws : close()
    activate exaws
    exaws -> ws : close()
    activate ws
    ws -> luws : wsclose(socket)
    activate luws
    luws -> luws : Close socket
    destroy luws
    luws - -> ws
    ws - -> exaws
    destroy ws
    exaws - -> conn
    destroy exaws
    conn - -> client: true
    destroy conn
end

@enduml

@startuml seq_connection_close
hide empty methods
hide empty attributes
skinparam style strictuml
skinparam classAttributeIconSize 0
!pragma horizontalLineBetweenDifferentPackageAllowed

skinparam defaultFontName Calibri

skinparam padding 2

participant "Client Code" as client <<external>>
box "Exasol Driver for Lua"
    participant Connection as conn << (C,#ADD1B2) >>
    participant Cursor as cur << (C,#ADD1B2) >>
    participant ExasolWebsocket as exaws << (C,#ADD1B2) >>
    participant Websocket as ws << (C,#ADD1B2) >>
    participant "LuWS Socket" as luws <<Third party library>>
end box
participant "Exasol Database" as db

activate client
activate db

client -> conn : close()
activate conn
loop for all cursors
    conn -> cur : closed
    activate cur
    cur - -> conn: is closed
    deactivate cur
end
alt at least one cursor is not closed
    conn - -> client: false
else all cursors are closed
    conn -> exaws : send_disconnect()
    activate exaws
    exaws -> ws : send_raw(payload)
    activate ws
    ws -> luws : wssend(socket,\npayload)
    activate luws
    luws -> db
    db - -> luws
    luws - -> ws
    deactivate luws
    ws - -> exaws
    deactivate ws
    exaws - -> conn
    deactivate exaws
    conn -> exaws : close()
    activate exaws
    exaws -> ws : close()
    activate ws
    ws -> luws : wsclose(socket)
    activate luws
    luws -> luws : Close socket
    destroy luws
    luws - -> ws
    ws - -> exaws
    destroy ws
    exaws - -> conn
    destroy exaws
    conn - -> client: true
    destroy conn
end

@enduml

PlantUML version 1.2022.4(Sat Apr 09 15:29:17 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: DE
--></g></svg>